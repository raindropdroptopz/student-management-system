generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model attendance_records {
  attendance_id   Int                       @id @default(autoincrement()) @db.UnsignedInt
  section_id      Int                       @db.UnsignedInt
  student_id      Int                       @db.UnsignedInt
  attendance_date DateTime                  @db.Date
  status          attendance_records_status @default(present)
  note            String?                   @db.VarChar(255)
  class_sections  class_sections            @relation(fields: [section_id], references: [section_id], onDelete: Cascade, map: "fk_attendance_section")
  students        students                  @relation(fields: [student_id], references: [student_id], onDelete: Cascade, map: "fk_attendance_student")

  @@unique([section_id, student_id, attendance_date], map: "uk_attendance")
  @@index([student_id], map: "fk_attendance_student")
}

model class_sections {
  section_id         Int                  @id @default(autoincrement()) @db.UnsignedInt
  course_id          Int                  @db.UnsignedInt
  semester_id        Int                  @db.UnsignedInt
  section_no         String               @db.VarChar(10)
  instructor_id      Int                  @db.UnsignedInt
  classroom          String?              @db.VarChar(50)
  schedule_info      String?              @db.VarChar(255)
  capacity           Int?                 @default(50) @db.UnsignedInt
  attendance_records attendance_records[]
  courses            courses              @relation(fields: [course_id], references: [course_id], map: "fk_section_course")
  instructors        instructors          @relation(fields: [instructor_id], references: [instructor_id], map: "fk_section_instructor")
  semesters          semesters            @relation(fields: [semester_id], references: [semester_id], map: "fk_section_semester")
  enrollments        enrollments[]

  @@unique([course_id, semester_id, section_no], map: "uk_course_semester_section")
  @@index([instructor_id], map: "fk_section_instructor")
  @@index([semester_id], map: "fk_section_semester")
}

model courses {
  course_id      Int              @id @default(autoincrement()) @db.UnsignedInt
  department_id  Int              @db.UnsignedInt
  course_code    String           @unique(map: "course_code") @db.VarChar(20)
  course_name_th String           @db.VarChar(255)
  course_name_en String?          @db.VarChar(255)
  credit         Decimal          @db.Decimal(3, 1)
  lecture_hour   Int?             @default(0) @db.UnsignedTinyInt
  lab_hour       Int?             @default(0) @db.UnsignedTinyInt
  description    String?          @db.Text
  class_sections class_sections[]
  departments    departments      @relation(fields: [department_id], references: [department_id], map: "fk_course_department")

  @@index([department_id], map: "fk_course_department")
}

model departments {
  department_id Int        @id @default(autoincrement()) @db.UnsignedInt
  code          String     @unique(map: "code") @db.VarChar(10)
  name_th       String     @db.VarChar(255)
  name_en       String?    @db.VarChar(255)
  courses       courses[]
  programs      programs[]
}

model enrollments {
  enrollment_id  Int                @id @default(autoincrement()) @db.UnsignedInt
  student_id     Int                @db.UnsignedInt
  section_id     Int                @db.UnsignedInt
  enroll_date    DateTime           @db.Date
  status         enrollments_status @default(enrolled)
  final_score    Decimal?           @db.Decimal(5, 2)
  final_grade    String?            @db.VarChar(2)
  class_sections class_sections     @relation(fields: [section_id], references: [section_id], onDelete: Cascade, map: "fk_enrollment_section")
  students       students           @relation(fields: [student_id], references: [student_id], onDelete: Cascade, map: "fk_enrollment_student")

  @@unique([student_id, section_id], map: "uk_student_section")
  @@index([section_id], map: "fk_enrollment_section")
}

model instructors {
  instructor_id  Int                @id @default(autoincrement()) @db.UnsignedInt
  employee_no    String             @unique(map: "employee_no") @db.VarChar(20)
  prefix         String?            @db.VarChar(20)
  first_name_th  String             @db.VarChar(100)
  last_name_th   String             @db.VarChar(100)
  first_name_en  String?            @db.VarChar(100)
  last_name_en   String?            @db.VarChar(100)
  email          String?            @db.VarChar(255)
  phone          String?            @db.VarChar(20)
  status         instructors_status @default(active)
  class_sections class_sections[]
  users          users?
}

model programs {
  program_id    Int            @id @default(autoincrement()) @db.UnsignedInt
  department_id Int            @db.UnsignedInt
  code          String         @unique(map: "code") @db.VarChar(20)
  name_th       String         @db.VarChar(255)
  name_en       String?        @db.VarChar(255)
  level         programs_level @default(Bachelor)
  departments   departments    @relation(fields: [department_id], references: [department_id], map: "fk_program_department")
  students      students[]

  @@index([department_id], map: "fk_program_department")
}

model semesters {
  semester_id    Int              @id @default(autoincrement()) @db.UnsignedInt
  academic_year  Int              @db.UnsignedSmallInt
  term           Int              @db.UnsignedTinyInt
  start_date     DateTime         @db.Date
  end_date       DateTime         @db.Date
  class_sections class_sections[]

  @@unique([academic_year, term], map: "uk_semester_year_term")
}

model students {
  student_id         Int                  @id @default(autoincrement()) @db.UnsignedInt
  student_no         String               @unique(map: "student_no") @db.VarChar(20)
  program_id         Int                  @db.UnsignedInt
  citizen_id         String?              @db.VarChar(20)
  prefix             String?              @db.VarChar(20)
  first_name_th      String               @db.VarChar(100)
  last_name_th       String               @db.VarChar(100)
  first_name_en      String?              @db.VarChar(100)
  last_name_en       String?              @db.VarChar(100)
  gender             students_gender?
  date_of_birth      DateTime?            @db.Date
  email              String?              @db.VarChar(255)
  phone              String?              @db.VarChar(20)
  status             students_status      @default(active)
  attendance_records attendance_records[]
  enrollments        enrollments[]
  programs           programs             @relation(fields: [program_id], references: [program_id], map: "fk_student_program")
  users              users?

  @@index([program_id], map: "fk_student_program")
}

model users {
  user_id       Int          @id @default(autoincrement()) @db.UnsignedInt
  username      String       @unique(map: "username") @db.VarChar(50)
  password_hash String       @db.VarChar(255)
  role          users_role   @default(student)
  student_id    Int?         @unique(map: "uk_user_student") @db.UnsignedInt
  instructor_id Int?         @unique(map: "uk_user_instructor") @db.UnsignedInt
  is_active     Boolean      @default(true)
  last_login    DateTime?    @db.DateTime(0)
  created_at    DateTime     @default(now()) @db.DateTime(0)
  updated_at    DateTime     @default(now()) @db.DateTime(0)
  instructors   instructors? @relation(fields: [instructor_id], references: [instructor_id], map: "fk_user_instructor")
  students      students?    @relation(fields: [student_id], references: [student_id], map: "fk_user_student")
}

enum users_role {
  student
  instructor
  admin
  staff
}

enum attendance_records_status {
  present
  absent
  late
  excused
}

enum enrollments_status {
  enrolled
  dropped
  withdrawn
  completed
}

enum programs_level {
  Bachelor
  Master
  Doctoral
}

enum instructors_status {
  active
  inactive
}

enum students_gender {
  M
  F
  Other
}

enum students_status {
  active
  inactive
  graduated
  suspended
}
